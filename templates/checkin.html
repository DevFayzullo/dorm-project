<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ê¸°ìˆ™ì‚¬ ì…ì‹¤ ì‹ ì²­</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous" />
    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"></script>
  </head>
  <body>
    <header class="main-header">
      <h1>ğŸ“ ê¸°ìˆ™ì‚¬ ì…ì‹¤ ì‹ ì²­ í˜ì´ì§€</h1>
      <p>ê¸°ìˆ™ì‚¬ ì…ì‹¤ì„ ìœ„í•œ ì‹ ì²­ì„œë¥¼ ì‘ì„±í•´ ì£¼ì„¸ìš”</p>
    </header>

    <!-- checkin_form.html -->
    <div class="form-container">
      <form method="post">
        {% if step == 1 %}
        <h2>â‘  ì •ë³´ ì…ë ¥</h2>

        <label for="name">ì´ë¦„</label>
        <input
          type="text"
          id="name"
          name="name"
          value="{{ current_user.full_name }}"
          required
          readonly />

        <label for="studentId">í•™ë²ˆ</label>
        <input
          type="text"
          id="studentId"
          name="studentId"
          value="{{ current_user.userid }}"
          required
          readonly />

        <label for="phone">ì „í™”ë²ˆí˜¸</label>
        <input
          type="tel"
          id="phone"
          name="phone"
          value="{{ current_user.phone_number }}"
          required />

        <input type="hidden" name="step" value="1" />
        <button type="submit" name="direction" value="next">ë‹¤ìŒ</button>

        {% elif step == 2 %}
        <h2>â‘¡ ì…ì‹¤ ì •ë³´</h2>

        <input type="hidden" name="name" value="{{ current_user.full_name }}" />
        <input
          type="hidden"
          name="studentId"
          value="{{ current_user.userid }}" />
        <input
          type="hidden"
          name="phone"
          value="{{ current_user.phone_number }}" />

        <label for="date">ì‹ ì²­ë‚ ì§œ</label>
        <input
          type="date"
          id="date"
          name="date"
          value="{{ date }}"
          required
          readonly />

        <!-- Qavat tanlash -->
        <label for="floorSelect">ì¸µ ì„ íƒ</label>
        <select id="floorSelect" name="floor">
          <option value="">ì¸µ ì„ íƒ</option>
          {% for f in floors %}
          <option value="{{ f }}">{{ f }}ì¸µ</option>
          {% endfor %}
        </select>

        <!-- Xona tanlash -->
        <label for="room">í˜¸ì‹¤</label>
        <select id="room" name="room" required>
          <option value="">í˜¸ì‹¤ ì„ íƒ</option>
        </select>

        <script>
          document
            .getElementById("floorSelect")
            .addEventListener("change", function () {
              const floor = this.value;
              fetch(`/room-status/${floor}`)
                .then((response) => response.json())
                .then((data) => {
                  const roomSelect = document.getElementById("room");
                  roomSelect.innerHTML = '<option value="">í˜¸ì‹¤ ì„ íƒ</option>';
                  data.rooms.forEach((room) => {
                    const option = document.createElement("option");
                    option.value = room;
                    option.text = `${room}í˜¸`;
                    roomSelect.add(option);
                  });
                });
            });
        </script>

        <input type="hidden" name="step" value="2" />
        <button type="submit" name="direction" value="back">ì´ì „</button>
        <button type="submit" name="direction" value="next">ë‹¤ìŒ</button>

        {% elif step == 3 %}
        <h2>â‘¢ í™•ì¸ ë° ì œì¶œ</h2>
        <br />
        <input type="hidden" name="name" value="{{ current_user.full_name }}" />
        <input
          type="hidden"
          name="studentId"
          value="{{ current_user.userid }}" />
        <input
          type="hidden"
          name="phone"
          value="{{ current_user.phone_number }}" />
        <input type="hidden" name="date" value="{{ date }}" />
        <input type="hidden" name="room" value="{{ room }}" />
        <input type="hidden" name="checkin" value="ì…ì‹¤" />

        <p style="margin: 10px 0">
          <strong>ì´ë¦„:</strong> {{ current_user.full_name }}
        </p>
        <p style="margin: 10px 0">
          <strong>í•™ë²ˆ:</strong> {{ current_user.userid }}
        </p>
        <p style="margin: 10px 0">
          <strong>ì „í™”ë²ˆí˜¸:</strong> {{ current_user.phone_number }}
        </p>
        <p style="margin: 10px 0"><strong>ì‹ ì²­ë‚ ì§œ:</strong> {{ date }}</p>
        <p style="margin: 10px 0"><strong>ì„ íƒí•œ í˜¸ì‹¤:</strong> {{ room }}í˜¸</p>

        <input type="hidden" name="step" value="3" />
        <button type="submit" name="direction" value="back">ì´ì „</button>
        <button type="submit" name="direction" value="next">ì œì¶œ</button>
        {% endif %}
      </form>

      <p style="text-align: center; margin-top: 20px">
        <a href="{{ url_for('index') }}">â† ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
      </p>
    </div>

    <footer class="main-footer bg-dark text-light text-center py-4 mt-5">
      <div class="container">
        <strong>Â© 2025 Dormitory Management System</strong><br />
        <small>All rights reserved.</small>
      </div>
    </footer>
  </body>
</html>
